import"../chunks/D5ZjBwPo.js";import{aQ as ne,aF as se,A as oe,aG as ie,F as ae,aR as ue,G as le,k as ce,J as fe}from"../chunks/CsMi2wPb.js";import{s as de}from"../chunks/C2QGexOf.js";var he=Object.defineProperty,pe=Object.defineProperties,ye=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertySymbols,ge=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable,H=(e,t,r)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,w=(e,t)=>{for(var r in t||(t={}))ge.call(t,r)&&H(e,r,t[r]);if(J)for(var r of J(t))me.call(t,r)&&H(e,r,t[r]);return e},_=(e,t)=>pe(e,ye(t)),ve=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},we=async(e,t)=>{var r,n,s,l,a,d;let c=t||{};const o={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:c,hooks:o};for(const i of t?.plugins||[]){if(i.init){const f=await((r=i.init)==null?void 0:r.call(i,e.toString(),t));c=f.options||c,e=f.url}o.onRequest.push((n=i.hooks)==null?void 0:n.onRequest),o.onResponse.push((s=i.hooks)==null?void 0:s.onResponse),o.onSuccess.push((l=i.hooks)==null?void 0:l.onSuccess),o.onError.push((a=i.hooks)==null?void 0:a.onError),o.onRetry.push((d=i.hooks)==null?void 0:d.onRetry)}return{url:e,options:c,hooks:o}},V=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},_e=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function be(e){if(typeof e=="number")return new V({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new V(e);case"exponential":return new _e(e);default:throw new Error("Invalid retry strategy")}}var Re=async e=>{const t={},r=async n=>typeof n=="function"?await n():n;if(e?.auth){if(e.auth.type==="Bearer"){const n=await r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if(e.auth.type==="Basic"){const n=r(e.auth.username),s=r(e.auth.password);if(!n||!s)return t;t.authorization=`Basic ${btoa(`${n}:${s}`)}`}else if(e.auth.type==="Custom"){const n=r(e.auth.value);if(!n)return t;t.authorization=`${r(e.auth.prefix)} ${n}`}}return t},Te=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Se(e){const t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const n=t.split(";").shift()||"";return Te.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}function Oe(e){try{return JSON.parse(e),!0}catch{return!1}}function X(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function G(e){try{return JSON.parse(e)}catch{return e}}function Q(e){return typeof e=="function"}function Pe(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&Q(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&Q(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function Ee(e){const t=new Headers(e?.headers),r=await Re(e);for(const[n,s]of Object.entries(r||{}))t.set(n,s);if(!t.has("content-type")){const n=Le(e?.body);n&&t.set("content-type",n)}return t}function Le(e){return X(e)?"application/json":null}function Ue(e){if(!e?.body)return null;const t=new Headers(e?.headers);if(X(e.body)&&!t.has("content-type")){for(const[r,n]of Object.entries(e?.body))n instanceof Date&&(e.body[r]=n.toISOString());return JSON.stringify(e.body)}return e.body}function Ae(e,t){var r;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){const n=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return Z.includes(n)?n.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function Ie(e,t){let r;return!e?.signal&&e?.timeout&&(r=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}var xe=class Y extends Error{constructor(t,r){super(r||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,Y.prototype)}};async function C(e,t){let r=await e["~standard"].validate(t);if(r.issues)throw new xe(r.issues);return r.value}var Z=["get","post","put","patch","delete"],Ne=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,r){var n,s,l,a;const d=((s=(n=e.plugins)==null?void 0:n.find(c=>{var o;return(o=c.schema)!=null&&o.config?t.startsWith(c.schema.config.baseURL||"")||t.startsWith(c.schema.config.prefix||""):!1}))==null?void 0:s.schema)||e.schema;if(d){let c=t;(l=d.config)!=null&&l.prefix&&c.startsWith(d.config.prefix)&&(c=c.replace(d.config.prefix,""),d.config.baseURL&&(t=t.replace(d.config.prefix,d.config.baseURL))),(a=d.config)!=null&&a.baseURL&&c.startsWith(d.config.baseURL)&&(c=c.replace(d.config.baseURL,""));const o=d.schema[c];if(o){let i=_(w({},r),{method:o.method,output:o.output});return r?.disableValidation||(i=_(w({},i),{body:o.input?await C(o.input,r?.body):r?.body,params:o.params?await C(o.params,r?.params):r?.params,query:o.query?await C(o.query,r?.query):r?.query})),{url:t,options:i}}}return{url:t,options:r}}}),qe=e=>{async function t(r,n){const s=_(w(w({},e),n),{plugins:[...e?.plugins||[],Ne(e||{})]});if(e?.catchAllError)try{return await M(r,s)}catch(l){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:l}}}return await M(r,s)}return t};function je(e,t){let{baseURL:r,params:n,query:s}=t||{query:{},params:{},baseURL:""},l=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r||"";if(e.startsWith("@")){const f=e.toString().split("@")[1].split("/")[0];Z.includes(f)&&(e=e.replace(`@${f}/`,"/"))}l.endsWith("/")||(l+="/");let[a,d]=e.replace(l,"").split("?");const c=new URLSearchParams(d);for(const[f,h]of Object.entries(s||{}))h!=null&&c.set(f,String(h));if(n)if(Array.isArray(n)){const f=a.split("/").filter(h=>h.startsWith(":"));for(const[h,b]of f.entries()){const R=n[h];a=a.replace(b,R)}}else for(const[f,h]of Object.entries(n))a=a.replace(`:${f}`,String(h));a=a.split("/").map(encodeURIComponent).join("/"),a.startsWith("/")&&(a=a.slice(1));let o=c.toString();return o=o.length>0?`?${o}`.replace(/\+/g,"%20"):"",l.startsWith("http")?new URL(`${a}${o}`,l):`${l}${a}${o}`}var M=async(e,t)=>{var r,n,s,l,a,d,c,o;const{hooks:i,url:f,options:h}=await we(e,t),b=Pe(h),R=new AbortController,A=(r=h.signal)!=null?r:R.signal,g=je(f,h),L=Ue(h),P=await Ee(h),T=Ae(f,h);let u=_(w({},h),{url:g,headers:P,body:L,method:T,signal:A});for(const m of i.onRequest)if(m){const y=await m(u);y instanceof Object&&(u=y)}("pipeTo"in u&&typeof u.pipeTo=="function"||typeof((n=t?.body)==null?void 0:n.pipe)=="function")&&("duplex"in u||(u.duplex="half"));const{clearTimeout:I}=Ie(h,R);let p=await b(u.url,u);I();const $={response:p,request:u};for(const m of i.onResponse)if(m){const y=await m(_(w({},$),{response:(s=t?.hookOptions)!=null&&s.cloneResponse?p.clone():p}));y instanceof Response?p=y:y instanceof Object&&(p=y.response)}if(p.ok){if(!(u.method!=="HEAD"))return{data:"",error:null};const y=Se(p),S={data:"",response:p,request:u};if(y==="json"||y==="text"){const O=await p.text(),re=await((l=u.jsonParser)!=null?l:G)(O);S.data=re}else S.data=await p[y]();u?.output&&u.output&&!u.disableValidation&&(S.data=await C(u.output,S.data));for(const O of i.onSuccess)O&&await O(_(w({},S),{response:(a=t?.hookOptions)!=null&&a.cloneResponse?p.clone():p}));return t?.throw?S.data:{data:S.data,error:null}}const ee=(d=t?.jsonParser)!=null?d:G,N=await p.text(),W=Oe(N),D=W?await ee(N):null,te={response:p,responseText:N,request:u,error:_(w({},D),{status:p.status,statusText:p.statusText})};for(const m of i.onError)m&&await m(_(w({},te),{response:(c=t?.hookOptions)!=null&&c.cloneResponse?p.clone():p}));if(t?.retry){const m=be(t.retry),y=(o=t.retryAttempt)!=null?o:0;if(await m.shouldAttemptRetry(y,p)){for(const O of i.onRetry)O&&await O($);const S=m.getDelay(y);return await new Promise(O=>setTimeout(O,S)),await M(e,_(w({},t),{retryAttempt:y+1}))}}if(t?.throw)throw new ve(p.status,p.statusText,W?D:N);return{data:null,error:_(w({},D),{status:p.status,statusText:p.statusText})}},ke={};const F=Object.create(null),x=e=>ke||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?F:globalThis),U=new Proxy(F,{get(e,t){return x()[t]??F[t]},has(e,t){const r=x();return t in r||t in F},set(e,t,r){const n=x(!0);return n[t]=r,!0},deleteProperty(e,t){if(!t)return!1;const r=x(!0);return delete r[t],!0},ownKeys(){const e=x(!0);return Object.keys(e)}});class Ce extends Error{constructor(t,r){super(t),this.name="BetterAuthError",this.message=t,this.cause=r,this.stack=""}}function Fe(e){try{return(new URL(e).pathname.replace(/\/+$/,"")||"/")!=="/"}catch{throw new Ce(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function B(e,t="/api/auth"){if(Fe(e))return e;const n=e.replace(/\/+$/,"");return!t||t==="/"?n:(t=t.startsWith("/")?t:`/${t}`,`${n}${t}`)}function De(e,t,r,n){if(e)return B(e,t);{const s=U.BETTER_AUTH_URL||U.NEXT_PUBLIC_BETTER_AUTH_URL||U.PUBLIC_BETTER_AUTH_URL||U.NUXT_PUBLIC_BETTER_AUTH_URL||U.NUXT_PUBLIC_AUTH_URL||(U.BASE_URL!=="/"?U.BASE_URL:void 0);if(s)return B(s,t)}if(typeof window<"u"&&window.location)return B(window.location.origin,t)}let v=[],E=0;const q=4;let K=e=>{let t=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},lc:0,listen(n){return r.lc=t.push(n),()=>{for(let l=E+q;l<v.length;)v[l]===n?v.splice(l,q):l+=q;let s=t.indexOf(n);~s&&(t.splice(s,1),--r.lc||r.off())}},notify(n,s){let l=!v.length;for(let a of t)v.push(a,r.value,n,s);if(l){for(E=0;E<v.length;E+=q)v[E](v[E+1],v[E+2],v[E+3]);v.length=0}},off(){},set(n){let s=r.value;s!==n&&(r.value=n,r.notify(s))},subscribe(n){let s=r.listen(n);return n(r.value),s},value:e};return r};const Be=5,j=6,k=10;let Me=(e,t,r,n)=>(e.events=e.events||{},e.events[r+k]||(e.events[r+k]=n(s=>{e.events[r].reduceRight((l,a)=>(a(l),l),{shared:{},...s})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let s=e.events[r],l=s.indexOf(t);s.splice(l,1),s.length||(delete e.events[r],e.events[r+k](),delete e.events[r+k])}),$e=1e3,We=(e,t)=>Me(e,n=>{let s=t(n);s&&e.events[j].push(s)},Be,n=>{let s=e.listen;e.listen=(...a)=>(!e.lc&&!e.active&&(e.active=!0,n()),s(...a));let l=e.off;return e.events[j]=[],e.off=()=>{l(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let a of e.events[j])a();e.events[j]=[]}},$e)},()=>{e.listen=s,e.off=l}});const Je=typeof window>"u",He=(e,t,r,n)=>{const s=K({data:null,error:null,isPending:!0,isRefetching:!1,refetch:d=>l(d)}),l=d=>{const c=typeof n=="function"?n({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):n;r(t,{...c,query:{...c?.query,...d?.query},async onSuccess(o){s.set({data:o.data,error:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await c?.onSuccess?.(o)},async onError(o){const{request:i}=o,f=typeof i.retry=="number"?i.retry:i.retry?.attempts,h=i.retryAttempt||0;f&&h<f||(s.set({error:o.error,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await c?.onError?.(o))},async onRequest(o){const i=s.get();s.set({isPending:i.data===null,data:i.data,error:null,isRefetching:!0,refetch:s.value.refetch}),await c?.onRequest?.(o)}}).catch(o=>{s.set({error:o,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch})})};e=Array.isArray(e)?e:[e];let a=!1;for(const d of e)d.subscribe(()=>{Je||(a?l():We(s,()=>{const c=setTimeout(()=>{a||(l(),a=!0)},0);return()=>{s.off(),d.off(),clearTimeout(c)}}))});return s},Ve={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},Ge=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,z={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},Qe=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function ze(e){return e instanceof Date&&!isNaN(e.getTime())}function Xe(e){const t=Qe.exec(e);if(!t)return null;const[,r,n,s,l,a,d,c,o,i,f]=t;let h=new Date(Date.UTC(parseInt(r,10),parseInt(n,10)-1,parseInt(s,10),parseInt(l,10),parseInt(a,10),parseInt(d,10),c?parseInt(c.padEnd(3,"0"),10):0));if(o){const b=(parseInt(i,10)*60+parseInt(f,10))*(o==="+"?-1:1);h.setUTCMinutes(h.getUTCMinutes()+b)}return ze(h)?h:null}function Ye(e,t={}){const{strict:r=!1,warnings:n=!1,reviver:s,parseDates:l=!0}=t;if(typeof e!="string")return e;const a=e.trim();if(a.length>0&&a[0]==='"'&&a.endsWith('"')&&!a.slice(1,-1).includes('"'))return a.slice(1,-1);const d=a.toLowerCase();if(d.length<=9&&d in z)return z[d];if(!Ge.test(a)){if(r)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(Ve).some(([o,i])=>{const f=i.test(a);return f&&n&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${o} pattern`),f})&&r)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(a,(i,f)=>{if(i==="__proto__"||i==="constructor"&&f&&typeof f=="object"&&"prototype"in f){n&&console.warn(`[better-json] Dropping "${i}" key to prevent prototype pollution`);return}if(l&&typeof f=="string"){const h=Xe(f);if(h)return h}return s?s(i,f):f})}catch(o){if(r)throw o;return e}}function Ze(e,t={strict:!0}){return Ye(e,t)}const Ke={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}};function et(e){const t=K(!1);return{session:He(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}const tt=(e,t)=>{const r="credentials"in Request.prototype,n=De(e?.baseURL,e?.basePath)??"/api/auth",s=e?.plugins?.flatMap(u=>u.fetchPlugins).filter(u=>u!==void 0)||[],l={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:e?.fetchOptions?.onSuccess,onError:e?.fetchOptions?.onError,onRequest:e?.fetchOptions?.onRequest,onResponse:e?.fetchOptions?.onResponse}},{onSuccess:a,onError:d,onRequest:c,onResponse:o,...i}=e?.fetchOptions||{},f=qe({baseURL:n,...r?{credentials:"include"}:{},method:"GET",jsonParser(u){return u?Ze(u,{strict:!1}):null},customFetchImpl:fetch,...i,plugins:[l,...i.plugins||[],...e?.disableDefaultFetchPlugins?[]:[Ke],...s]}),{$sessionSignal:h,session:b}=et(f),R=e?.plugins||[];let A={},g={$sessionSignal:h,session:b},L={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const P=[{signal:"$sessionSignal",matcher(u){return u==="/sign-out"||u==="/update-user"||u.startsWith("/sign-in")||u.startsWith("/sign-up")||u==="/delete-user"||u==="/verify-email"}}];for(const u of R)u.getAtoms&&Object.assign(g,u.getAtoms?.(f)),u.pathMethods&&Object.assign(L,u.pathMethods),u.atomListeners&&P.push(...u.atomListeners);const T={notify:u=>{g[u].set(!g[u].get())},listen:(u,I)=>{g[u].subscribe(I)},atoms:g};for(const u of R)u.getActions&&Object.assign(A,u.getActions?.(f,T,e));return{get baseURL(){return n},pluginsActions:A,pluginsAtoms:g,pluginPathMethods:L,atomListeners:P,$fetch:f,$store:T}};function rt(e){return typeof e=="object"&&e!==null&&"get"in e&&typeof e.get=="function"&&"lc"in e&&typeof e.lc=="number"}function nt(e,t,r){const n=t[e],{fetchOptions:s,query:l,...a}=r||{};return n||(s?.method?s.method:a&&Object.keys(a).length>0?"POST":"GET")}function st(e,t,r,n,s){function l(a=[]){return new Proxy(function(){},{get(d,c){if(typeof c!="string"||c==="then"||c==="catch"||c==="finally")return;const o=[...a,c];let i=e;for(const f of o)if(i&&typeof i=="object"&&f in i)i=i[f];else{i=void 0;break}return typeof i=="function"||rt(i)?i:l(o)},apply:async(d,c,o)=>{const i="/"+a.map(P=>P.replace(/[A-Z]/g,T=>`-${T.toLowerCase()}`)).join("/"),f=o[0]||{},h=o[1]||{},{query:b,fetchOptions:R,...A}=f,g={...h,...R},L=nt(i,r,f);return await t(i,{...g,body:L==="GET"?void 0:{...A,...g?.body||{}},query:b||g?.query,method:L,async onSuccess(P){await g?.onSuccess?.(P);const T=s?.find(p=>p.matcher(i));if(!T)return;const u=n[T.signal];if(!u)return;const I=u.get();setTimeout(()=>{u.set(!I)},10)}})}})}return l()}function ot(e){return e.charAt(0).toUpperCase()+e.slice(1)}function it(e){const{pluginPathMethods:t,pluginsActions:r,pluginsAtoms:n,$fetch:s,atomListeners:l,$store:a}=tt(e);let d={};for(const[i,f]of Object.entries(n))d[`use${ot(i)}`]=f;const c={...r,...d,$fetch:s,$store:a};return st(c,s,t,n,l)}const at=it({}),{signIn:ut,signOut:lt,signUp:ct,useSession:mt}=at;class ft{#e=ne(se({user:null,session:null,isLoading:!1}));get state(){return oe(this.#e)}set state(t){ie(this.#e,t,!0)}get user(){return this.state.user}get session(){return this.state.session}get isLoading(){return this.state.isLoading}get isAuthenticated(){return!!this.state.user}initialize(t,r){this.state.user=t,this.state.session=r,this.state.isLoading=!1}async signIn(t,r){this.state.isLoading=!0;try{const n=await ut.email({email:t,password:r});return n.error?alert(n.error.message):(this.state.user=n.data.user,this.state.isLoading=!1,n)}catch(n){throw n}finally{this.state.isLoading=!1}}async signUp(t,r,n){this.state.isLoading=!0;try{const s=await ct.email({email:t,password:r,name:n||t.split("@")[0]});return s.error?alert(s.error.message):s}catch(s){throw s}finally{this.state.isLoading=!1}}async signOut(){this.state.isLoading=!0;try{await lt(),this.state.user=null,this.state.session=null,this.state.isLoading=!1}catch(t){throw t}finally{this.state.isLoading=!1}}updateSession(t,r){this.state.user=t,this.state.session=r,this.state.isLoading=!1}}const dt=new ft;function vt(e,t){ae(t,!0),dt.initialize(t.data.user,t.data.session);var r=ue(),n=le(r);de(n,()=>t.children),ce(e,r),fe()}export{vt as component};

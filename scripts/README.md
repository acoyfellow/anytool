# Anytool AI Search Scripts

Three simple scripts to set up AI search with Cloudflare R2 bucket for the Anytool documentation.

## Overview

1. **`1-parse-llms-txt.js`** - Converts `llms.txt` to CSV format
2. **`2-download-files.js`** - Downloads all markdown files from the CSV
3. **`3-upload-to-r2.js`** - Uploads files to the `anytool-docs` R2 bucket

## Usage

### Prerequisites

- Node.js installed
- Cloudflare account with R2 enabled
- API token with R2 permissions

### Step 1: Parse llms.txt to CSV

```bash
cd scripts
node 1-parse-llms-txt.js
```

This will:
- Download `https://developers.cloudflare.com/llms.txt`
- Parse it and extract name/URL pairs
- Save as `llms.csv`

### Step 2: Download files

```bash
node 2-download-files.js [csv-file] [output-dir]
```

Defaults: `llms.csv` → `downloaded-docs/`

This will:
- Read the CSV file
- Download all markdown files
- Save them with structured filenames
- Create a `manifest.json` for tracking

### Step 3: Upload to R2

First, set up environment variables:

```bash
export CLOUDFLARE_API_TOKEN="your-api-token"
export CLOUDFLARE_ACCOUNT_ID="your-account-id"
```

Then run:

```bash
node 3-upload-to-r2.js [input-dir]
```

Default: `downloaded-docs/`

This will:
- Check that the `anytool-docs` bucket exists
- Upload all files with proper object keys
- Create an upload summary

## Environment Variables

### Required for Script 3:

- `CLOUDFLARE_API_TOKEN` - Your Cloudflare API token with R2 permissions
- `CLOUDFLARE_ACCOUNT_ID` - Your Cloudflare account ID

### Getting Your Credentials:

1. **API Token**: Go to [Cloudflare API Tokens](https://dash.cloudflare.com/profile/api-tokens)
   - Create token with R2 permissions

2. **Account ID**: Found in your Cloudflare dashboard sidebar

## File Structure

After running all scripts:

```
scripts/
├── 1-parse-llms-txt.js
├── 2-download-files.js
├── 3-upload-to-r2.js
├── README.md
├── llms.csv                 # Generated by script 1
└── downloaded-docs/         # Generated by script 2
    ├── manifest.json
    ├── upload-summary.json  # Generated by script 3
    └── *.md files
```

## Next Steps

After uploading to R2:

1. **Configure AI Search** to index the `anytool-docs` bucket
2. **Set up Workers binding** for AI Search
3. **Test search functionality** in your application

## Troubleshooting

### Script 1 Issues:
- Check internet connectivity
- Verify `llms.txt` URL is accessible

### Script 2 Issues:
- Ensure CSV file exists (run script 1 first)
- Check file permissions for output directory

### Script 3 Issues:
- Verify environment variables are set
- Check API token permissions
- Ensure `anytool-docs` bucket exists in R2
- Verify account ID is correct

## API Permissions

Your Cloudflare API token needs:
- **R2:Edit** - To upload objects
- **R2:Read** - To check bucket existence

## Notes

- Script 2 includes small delays between downloads to be respectful to servers
- Script 3 includes delays between uploads for rate limiting
- All scripts include comprehensive error handling and progress reporting
- Manifest files help track the original URL → local file → R2 object mapping